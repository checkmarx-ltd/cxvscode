<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'unsafe-inline'; img-src data: blob:; object-src 'none'">
    <style>
        /* Checkmarx Theme color accents, rest is derived from & compatible with the VS Code Theme CSS */
        :root {
            --cx-bg-color: #007acc;
            --cx-fg-color: #eee;
        }
        
        
        * 								{ box-sizing: border-box }
        body							{ display: none; padding: 0px 10px 4px 10px; background-color: var(--vscode-tab-activeBackground); color: var(--vscode-editor-foreground) }
        
        #description 					{ padding: 5px 40px 0px 2px; white-space: initial; font-size: 105%; width: 90% }   
        
        #statusMessage, #commentError	{ color: var(--vscode-errorForeground) }
        
        .success 						{ color: var(--vscode-editor-foreground) !important }
        
        #statusMessage 					{ position: relative; display: inline-block; width: auto; min-height: 16px; top: 0px;  }
        #commentError					{ position: absolute; left: 25px }
        
        #prevPageButton, 
        #nextPageButton					{ display: none }
        #prevPageButton:disabled, 
        #nextPageButton:disabled,
        #prevPageButton:disabled:hover,
        #prevPageButton:disabled:hover	{ cursor: default; color: var(--vscode-disabledForeground); background-color: var(--vscode-tab-inactiveBackground) }
        
        
        button, select, option, 
        option:disabled					{ background-color: var(--vscode-dropdown-background); color: var(--vscode-editor-foreground); border-color: var(--cx-fg-color) }
        button, select					{ height: 25px; border: 1px solid var(--vscode-editor-background); border-radius: 5px }
        button 							{ display: inline-block; min-width: 60px; padding: auto 5px; font-weight: 500; text-align: center }
        button:hover 					{ cursor: pointer; background-color: var(--cx-bg-color); color: var(--cx-fg-color);  }
        select:hover 					{ cursor: pointer; background-color: var(--cx-bg-color)  }
        
        table#results	 				{ min-width: calc(100vw - 35px); width: auto; overflow: auto; padding-top: 6px; border-collapse: collapse; color: var(--vscode-editor-foreground) } 
        thead 							{ position: sticky; top: 0px; background-color: var(--vscode-tab-activeBackground) }
        td, th 							{ min-width: 20px; width: 0; padding: 2px 3px } 
        th, tr.results td 				{ border-right: 1px solid var(--vscode-panel-background) }
        th 								{ resize: horizontal; overflow: hidden; white-space: nowrap; padding: 2px 5px; 
                                          background-color: var(--cx-bg-color); color: var(--cx-fg-color) } 
        td								{ vertical-align: top }
        
        tr.actionBar td					{ padding: 8px 0 }
        tr.actionBar button,
        tr.actionBar select				{ margin: 0px 12px 0px 0px }
        
        tr.filters						{ background-color: var(--vscode-tab-inactiveBackground) }
        tr.filters td 					{ border-bottom: 1px solid var(--vscode-panel-background) }
        tr.filters input[type='text'],
        tr.filters select 				{ width: 100%; height: auto; border: 1px solid var(--vscode-editorGroupHeader-tabsBackground); border-radius: 0; 
                                          background-color: var(--vscode-tab-inactiveBackground); color: var(--vscode-disabledForeground) }
        
        tr.filters input[type='text']::placeholder,
        .placeholder					{ color: var(--vscode-disabledForeground) } 
        
        tr.result	   					{ background-color: var(--vscode-editor-background); color: var(--vscode-editor-foreground); vertical-align: top }
        tr.result:nth-child(even) 		{ background-color: var(--vscode-editorGroupHeader-tabsBackground) }
        tr.result:hover  				{ background-color: var(--vscode-tab-inactiveBackground); cursor: pointer }
        tr.result button 				{ height: 20px }
        tr.selected 					{ color: #fa5 !important } 
        
        th.noResize						{ resize: none }
        
        td.break 						{ white-space: nowrap; overflow-wrap: anywhere }
		td.numeric						{ width: 40px; text-align: right }
        td.vcenter						{ text-align: center; vertical-align: middle; padding: 2px 0px }
        
        .display						{ display: inline-block !important }
        .gold							{ color: var(--vscode-focusBorder) } 
        
        #commentOverlay					{ display: none; flex-flow: column; position: absolute; top: 0; left: 0; width: 100%; height: 100vh; z-index: 10; 
                                          background-color: var(--vscode-editor-background); padding: 5px 10px; text-align: center; vertical-align: middle }
        fieldset						{ border: 1px solid var(--vscode-tab-inactiveBackground); border-radius: 5px; 
                                          background-color: var(--vscode-editorGroupHeader-tabsBackground); margin-bottom: 8px }
        textarea						{ background-color: var(--vscode-tab-inactiveBackground); color: var(--vscode-editor-foreground); 
                                          border: 1px solid var(--vscode-editorGroupHeader-tabsBackground); border-radius: 5px; 
                                          width: 100%; height: 54px; padding: 3px 6px; margin-bottom: 8px }
        fieldset button					{ width: 90px; margin: 0 10px; height: 28px }
        legend							{ display: block; padding: 0 5px; text-align: left; color: var(--cx-bg-color) }
        fieldset.flexAuto				{ flex: 1 1 auto; overflow: scroll; text-align: left }
        fieldset.flexOne				{ flex: 0 0 125px }
        .flex							{ display: flex !important }
        #existingComments				{ width: 100% }
        
        ::-webkit-scrollbar 			{ width: 15px !important }
        
        /* Spinner */
        .loading						{ width: 16px !important; height: 16px !important; top: 4px !important;
                                          background: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB3aWR0aD0iMjBweCIgaGVpZ2h0PSIyMHB4IiB2aWV3Qm94PSIwIDAgNDAgNDAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDoxLjQxNDIxOyIgeD0iMHB4IiB5PSIwcHgiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbQC13ZWJraXQta2V5ZnJhbWVzIHNwaW4geyAgZnJvbSB7LXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKSAgfSAgdG8gey13ZWJraXQtdHJhbnNmb3JtOiByb3RhdGUoLTM1OWRlZykgIH19QGtleWZyYW1lcyBzcGluIHsgIGZyb20ge3RyYW5zZm9ybTogcm90YXRlKDBkZWcpICB9ICB0byB7dHJhbnNmb3JtOiByb3RhdGUoLTM1OWRlZykgIH19c3ZnIHstd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDUwJSA1MCU7LXdlYmtpdC1hbmltYXRpb246IHNwaW4gMS41cyBsaW5lYXIgaW5maW5pdGU7LXdlYmtpdC1iYWNrZmFjZS12aXNpYmlsaXR5OiBoaWRkZW47YW5pbWF0aW9uOiBzcGluIDEuNXMgbGluZWFyIGluZmluaXRlO31dXT48L3N0eWxlPjwvZGVmcz48ZyBpZD0ib3V0ZXIiPjxnPjxwYXRoIGQ9Ik0yMCwwQzIyLjIwNTgsMCAyMy45OTM5LDEuNzg4MTMgMjMuOTkzOSwzLjk5MzlDMjMuOTkzOSw2LjE5OTY4IDIyLjIwNTgsNy45ODc4MSAyMCw3Ljk4NzgxQzE3Ljc5NDIsNy45ODc4MSAxNi4wMDYxLDYuMTk5NjggMTYuMDA2MSwzLjk5MzlDMTYuMDA2MSwxLjc4ODEzIDE3Ljc5NDIsMCAyMCwwWiIgc3R5bGU9ImZpbGw6YmxhY2s7Ii8+PC9nPjxnPjxwYXRoIGQ9Ik01Ljg1Nzg2LDUuODU3ODZDNy40MTc1OCw0LjI5ODE1IDkuOTQ2MzgsNC4yOTgxNSAxMS41MDYxLDUuODU3ODZDMTMuMDY1OCw3LjQxNzU4IDEzLjA2NTgsOS45NDYzOCAxMS41MDYxLDExLjUwNjFDOS45NDYzOCwxMy4wNjU4IDcuNDE3NTgsMTMuMDY1OCA1Ljg1Nzg2LDExLjUwNjFDNC4yOTgxNSw5Ljk0NjM4IDQuMjk4MTUsNy40MTc1OCA1Ljg1Nzg2LDUuODU3ODZaIiBzdHlsZT0iZmlsbDpyZ2IoMjEwLDIxMCwyMTApOyIvPjwvZz48Zz48cGF0aCBkPSJNMjAsMzIuMDEyMkMyMi4yMDU4LDMyLjAxMjIgMjMuOTkzOSwzMy44MDAzIDIzLjk5MzksMzYuMDA2MUMyMy45OTM5LDM4LjIxMTkgMjIuMjA1OCw0MCAyMCw0MEMxNy43OTQyLDQwIDE2LjAwNjEsMzguMjExOSAxNi4wMDYxLDM2LjAwNjFDMTYuMDA2MSwzMy44MDAzIDE3Ljc5NDIsMzIuMDEyMiAyMCwzMi4wMTIyWiIgc3R5bGU9ImZpbGw6cmdiKDEzMCwxMzAsMTMwKTsiLz48L2c+PGc+PHBhdGggZD0iTTI4LjQ5MzksMjguNDkzOUMzMC4wNTM2LDI2LjkzNDIgMzIuNTgyNCwyNi45MzQyIDM0LjE0MjEsMjguNDkzOUMzNS43MDE5LDMwLjA1MzYgMzUuNzAxOSwzMi41ODI0IDM0LjE0MjEsMzQuMTQyMUMzMi41ODI0LDM1LjcwMTkgMzAuMDUzNiwzNS43MDE5IDI4LjQ5MzksMzQuMTQyMUMyNi45MzQyLDMyLjU4MjQgMjYuOTM0MiwzMC4wNTM2IDI4LjQ5MzksMjguNDkzOVoiIHN0eWxlPSJmaWxsOnJnYigxMDEsMTAxLDEwMSk7Ii8+PC9nPjxnPjxwYXRoIGQ9Ik0zLjk5MzksMTYuMDA2MUM2LjE5OTY4LDE2LjAwNjEgNy45ODc4MSwxNy43OTQyIDcuOTg3ODEsMjBDNy45ODc4MSwyMi4yMDU4IDYuMTk5NjgsMjMuOTkzOSAzLjk5MzksMjMuOTkzOUMxLjc4ODEzLDIzLjk5MzkgMCwyMi4yMDU4IDAsMjBDMCwxNy43OTQyIDEuNzg4MTMsMTYuMDA2MSAzLjk5MzksMTYuMDA2MVoiIHN0eWxlPSJmaWxsOnJnYigxODcsMTg3LDE4Nyk7Ii8+PC9nPjxnPjxwYXRoIGQ9Ik01Ljg1Nzg2LDI4LjQ5MzlDNy40MTc1OCwyNi45MzQyIDkuOTQ2MzgsMjYuOTM0MiAxMS41MDYxLDI4LjQ5MzlDMTMuMDY1OCwzMC4wNTM2IDEzLjA2NTgsMzIuNTgyNCAxMS41MDYxLDM0LjE0MjFDOS45NDYzOCwzNS43MDE5IDcuNDE3NTgsMzUuNzAxOSA1Ljg1Nzg2LDM0LjE0MjFDNC4yOTgxNSwzMi41ODI0IDQuMjk4MTUsMzAuMDUzNiA1Ljg1Nzg2LDI4LjQ5MzlaIiBzdHlsZT0iZmlsbDpyZ2IoMTY0LDE2NCwxNjQpOyIvPjwvZz48Zz48cGF0aCBkPSJNMzYuMDA2MSwxNi4wMDYxQzM4LjIxMTksMTYuMDA2MSA0MCwxNy43OTQyIDQwLDIwQzQwLDIyLjIwNTggMzguMjExOSwyMy45OTM5IDM2LjAwNjEsMjMuOTkzOUMzMy44MDAzLDIzLjk5MzkgMzIuMDEyMiwyMi4yMDU4IDMyLjAxMjIsMjBDMzIuMDEyMiwxNy43OTQyIDMzLjgwMDMsMTYuMDA2MSAzNi4wMDYxLDE2LjAwNjFaIiBzdHlsZT0iZmlsbDpyZ2IoNzQsNzQsNzQpOyIvPjwvZz48Zz48cGF0aCBkPSJNMjguNDkzOSw1Ljg1Nzg2QzMwLjA1MzYsNC4yOTgxNSAzMi41ODI0LDQuMjk4MTUgMzQuMTQyMSw1Ljg1Nzg2QzM1LjcwMTksNy40MTc1OCAzNS43MDE5LDkuOTQ2MzggMzQuMTQyMSwxMS41MDYxQzMyLjU4MjQsMTMuMDY1OCAzMC4wNTM2LDEzLjA2NTggMjguNDkzOSwxMS41MDYxQzI2LjkzNDIsOS45NDYzOCAyNi45MzQyLDcuNDE3NTggMjguNDkzOSw1Ljg1Nzg2WiIgc3R5bGU9ImZpbGw6cmdiKDUwLDUwLDUwKTsiLz48L2c+PC9nPjwvc3ZnPg') no-repeat; background-size: 100% }
        
        /* Cx Logo with some CSS a:hover and :active effects as an Easter Egg gimmick */
        #cxLogo 				{ position: absolute; top: 5px; right: 8px; width: 80px; height: 80px; border-radius: 5px; transform-origin: 110px 0px; transition: all 1s ease; transform: scale(0.7); 
                                  background: url(data:image/png;base64,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) 50% no-repeat }
        #cxLogo:hover			{ filter: blur(0) saturate(200%) opacity(1); box-shadow: 0px 0px 5px 1px #8888; border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; animation: cxBlobMorph 3s ease-in-out infinite }
        #cxLogo:active			{ filter: blur(64px) saturate(800%) opacity(0) }
        @keyframes cxBlobMorph 	{
              0% { border-radius:  60% 40% 30% 70% / 60% 30% 70% 40% } 
             50% { border-radius:  30% 60% 70% 40% / 50% 60% 30% 60% }
            100% { border-radius:  60% 40% 30% 70% / 60% 30% 70% 40% } 
        }
        
        @keyframes saturation 	{
              0% { filter: saturate(100%) } 
            100% { filter: saturate(6400%) } 
        }
        
        
        /* Minor tweak for the Dark Modern theme that comes with VS Code */
        body[data-vscode-theme-name="Dark Modern"] tr.result:hover,
        body[data-vscode-theme-name="Dark Modern"] textarea		{ background-color: var(--vscode-dropdown-background)  }
        
        
            </style>
</head>

<body>
    <table id="results">
		<thead>
			<tr><td id="description" colspan="13"></td></tr>
			<tr class="actionBar">
				<td colspan="12">
					<select id="pageSizeSelect" title="Number of Results per Page to display"><option>1</option><option>2</option><option>5</option><option selected>10</option><option>20</option><option>50</option><option>100</option></select>
					<button id="prevPageButton">&lt;</button>
					<button id="nextPageButton">&gt;</button>
					<select id="resultStateSelect"	title="Assign Result-State to selected Result(s)"></select>
					<select id="assignUserSelect" 	title="Assign User to selected Result(s)"></select>
					<button id="addCommentButton" 	title="Add Comment to selected Result(s)" > &nbsp; Add Comment(s) &nbsp; </button>
					<div id="statusMessage"></div>
				</td>
				<td id="cxLogo"></td>
			</tr>

			<tr class="header">
				<th title="Select All Results" class="noResize"><input type="checkbox" id="checkboxAll"></th>
				<th title="Id">Id</th>
				<th title="Result State">Result State</th>
				<th title="Status">Status</th>
				<th title="Source Folder">Source Folder</th>
				<th title="Source Filename">Source File</th>
				<th title="Source Line" class="numeric">Src Line</th>
				<th title="Source Object">Src Object</th>
				<th title="Destination Folder">Destination Folder</th>
				<th title="Destination Filename">Destination File</th>
				<th title="Destination Line" class="numeric">Dest Line</th>
				<th title="Destination Object">Dest Object</th>
				<!-- <th title="Result Severity">Severity</th> //-->
				<th title="Assigned User">User</th>
				<th title="Comments" class="noResize">Comments</th> 
			</tr>
			<tr class="filters"> 
				<td></td> 
				<td></td> 
				<td><select            name="state" 		id="resultStateFilter" title="Select Result State Filter to apply"></select></td> 
				<td><input type="text" name="status" 		placeholder="Filter"   title="Enter Status filter to apply"></td> 
				<td><input type="text" name="srcFolder" 	placeholder="Filter"   title="Enter Source Foldername filter to apply"></td> 
				<td><input type="text" name="srcFileName" 	placeholder="Filter"   title="Enter Source Filename filter to apply"></td> 
				<td><input type="text" name="srcLine" 		placeholder="Filter"   title="Enter Source Line filter to apply"></td> 
				<td><input type="text" name="srcName" 		placeholder="Filter"   title="Enter Source Object Name filter to apply"></td> 
				<td><input type="text" name="destFolder" 	placeholder="Filter"   title="Enter Destination Foldername filter to apply"></td> 
				<td><input type="text" name="destFilename" 	placeholder="Filter"   title="Enter Destination Filename filter to apply"></td> 
				<td><input type="text" name="destLine" 		placeholder="Filter"   title="Enter Destination Line filter to apply"></td> 
				<td><input type="text" name="destName" 		placeholder="Filter"   title="Enter Destination Object Name filter to apply"></td> 
				<!-- <td></td> //-->
				<td><select            name="assignedUser" 	id="assignUserFilter"  title="Select Assigned User Filter to apply"></select></td>
				<td></td> 
			</tr>
		</thead>
		<tbody id="tbody"></tbody>
	</table>

	<div id="tbodyShadow"></div>

	<div id="commentOverlay">
		<fieldset class="flexAuto">
			<legend> Existing Comment(s) </legend>
			<div id="existingComments"></div>
		</fieldset>

		<fieldset class="flexOne gold">
			<legend> Add new comment </legend>
			<textarea id="newComment" maxlength="999"></textarea>
			<br><span id="commentError"></span>
			<button onclick="saveComment()"> Save </button>
			<button onclick="cancelComment()"> Cancel </button>
			<input type="hidden" id="commentPathId" value="-1">
		</fieldset>
	</div>
</body>
<script>
    "use strict";

// Some UI configuration settings
const STATUS_DISPLAY_TIMEOUT 	= 3000; 			// Timeout in ms before auto-hiding an Status Message
const SHOW_LOADING_THRESHOLD	= 1;				// Threshold in number of selected Results for showing the 'loading' spinner when performing a Bulk update

// Dynamic text and UI related constants
const INFO_MANDATORY_COMMENTS	= "<span class='placeholder'>Comments are mandatory for Result State updates. Please enter a comment and click the [Save] button to continue.</span>";
const INFO_BULK_COMMENTS		= "Adding a Bulk Comment";

const INFO_NO_DESCRIPTION 		= "No Query result description available.";
const INFO_DESCRIPTION_PREFIX   = "<b>Result Description:</b> ";

const INFO_RESULTS_SAVED		= "<span class='success'>Changes saved</span>";

const ERR_NO_SELECTION	  		= "Please select one or more Results first.";
const ERR_EMPTY_COMMENT   		= "Can't save empty comments.";
const ERR_UNEXPECTED_MESSAGE    = "Received an unexpect VsCode API results type: ";

// Use global constants to resolve (most) static DOM elements early at page-load & only once; making the on-demand results-handling snappier.
// Dynamic elements and less-used single-shot accesses are still inlined / on-demand as a trade-off. 

const description		= qs("#description");		// DOM element for Query Result Description at top.
const statusMessage		= qs("#statusMessage");		// DOM element for (client-side logic) User-Action error messages

const resultsBody		= qs("#tbody");				// DOM element for Result Rows
const checkboxAll		= qs("#checkboxAll"); 		// DOM element for Select All Results Checkbox

const assignUserSelect  = qs("#assignUserSelect");	// DOM element for Assign User Dropdown
const assignUserFilter	= qs("#assignUserFilter");	// DOM element for Assign User Filter Dropdown
const resultStateSelect = qs("#resultStateSelect");	// DOM element for Result State Dropdown
const resultStateFilter = qs("#resultStateFilter");	// DOM element for Result State Filter Dropdown
const pageSizeSelect	= qs("#pageSizeSelect");	// DOM element for Number of Results per Page Dropdown
const prevPageButton	= qs("#prevPageButton");	// DOM element for Previous Page
const nextPageButton	= qs("#nextPageButton");	// DOM element for Next Page

const commentOverlay	= qs("#commentOverlay"); 	// DOM element for Result Comment(s) Overlay
const existingComments	= qs("#existingComments"); 	// DOM element for Existing Comments
const newComment		= qs("#newComment"); 		// DOM element for New Comment
const commentError		= qs("#commentError");		// DOM element for Comments Overlay error messages
const commentPathId     = qs("#commentPathId");		// DOM element for Single Comment Row Index caching; see also function showComment(e)

const vscode			= acquireVsCodeApi();		// Our VsCode API handle
var   results 			= "";						// The latest API results received
var   resultsFiltered   = null						// Copy of all (not only the already displayed) Results matching the active filter

var   timeoutRef		= null;						// Handle for setTimeout 
var   currentPage 		= 1;						// Current Results Page being displayed, starting at 1.

var	  strictNE  		= false;					// Automatically override when Mandatory Comments for 'Not Exploitable' server-setting is detected. 
var	  strictAll 		= false;					// Automatically override when Mandatory Comments for All Result States server-setting is detected.

// Our main VsCode results-listener
function handleMessage(event) {

// Store Results globally for easy reference and reset Filtered Results
results = event.data;
resultsFiltered = null;

// Wipe loading animation for 'pending changes feedback'.
statusMessage.classList.remove("loading");

// Handle all the different results types
switch (results.mesg) {

    // Detailed Description Callback for (selected) Result for SAST v9.x
    case "vsCode":
        updateDescription();
        return;

    // First-click fires when Query Results are loaded and functions as the 'onload' from the user-experience perspective.
    // The empty type is the "vsCode" failover callback for SAST v8.x
    case "firstClick":
    case "":
        vscode.postMessage({ path: results.Result[0].Path, mesg: "firstTime", clickedRow: 0});		// This loads the Attack Vector for this Node
        updateDescription();
        break;

    case "onChange":
        // Show Server-Error when Mandatory Comments for all State Changes or only Not Exploitable are enabled on the server but not yet in the Extension settings.
        
        switch (results.mandatoryCommentErrorMessage) {
            case 49797:
                strictNE  = false;
                strictAll = true;
                showStatusMessage("Server Setting detected: Comment required for changing Result State.<br>Plugin-configuration adjusted, please retry.<br>", STATUS_DISPLAY_TIMEOUT * 3);
                break;
            case 49798:
                strictNE  = true;
                strictAll = false;
                showStatusMessage("Server Setting deteced: Comment required for changing Result State to Not Exploitable.<br>Plugin-configuration adjusted, please retry.", STATUS_DISPLAY_TIMEOUT * 3);
                break;
            case 49814:
                strictNE  = true;
                strictAll = false;
                showStatusMessage("Server Setting deteced: Comment required for changing Result State to Proposed Not Exploitable.<br>Plugin-configuration adjusted, please retry.", STATUS_DISPLAY_TIMEOUT * 3);
                break;
            case "":
            case undefined:
                showStatusMessage(INFO_RESULTS_SAVED, STATUS_DISPLAY_TIMEOUT);
                break;
            default:
                showStatusMessage(ERR_UNEXPECTED_MESSAGE + "#" + results.mandatoryCommentErrorMessage + "#", STATUS_DISPLAY_TIMEOUT * 3);
        }
        break;

    // Should never happen
    default:
        showStatusMessage(ERR_UNEXPECTED_MESSAGE + results.mesg, STATUS_DISPLAY_TIMEOUT * 3);
}

// Populate Result State dropdown (using one extra dummy label option) and hookup event-handler
var html = "";
for (var i = 0; i < results.resultStates.states.length; i++) { if(results.resultStates.states[i].isUserHavePermission) html += "<option value='" + i + "'>" + results.resultStates.states[i].name + "</option>" }
resultStateSelect.innerHTML = "<option disabled selected class=''> Result State</option>" + html;
resultStateFilter.innerHTML = "<option value=''> - </option>" + html;
resultStateSelect.onchange  = changeResultState;
resultStateFilter.onchange  = filterResult;

// Populate Assigned User dropdown (using one extra dummy label option) and hookup event-handler
html = "";
results.usersList = results.usersList.sort();
for (var i = 0; i < results.usersList.length; i++) { html += "<option value='" + results.usersList[i] + "'>" + results.usersList[i] + "</option>" }
assignUserSelect.innerHTML = "<option disabled selected>Assign User</option><option value=''>[ Nobody ]</option>" + html;
assignUserFilter.innerHTML = "<option value=''> - </option>" + html;
assignUserSelect.onchange  = changeAssignUser;
assignUserFilter.onchange  = filterResult;

// Finally unhide static HTML content (so we only get 1 content-flash)
document.body.classList.add("display");

// Now Process & output the Results HTML for currentPage & handle the potential Results paging buttons display
renderResults();
}

function changePageSizeAndRefresh() { currentPage = 1; renderResults() }

// Render Results HTML output and handle Paging logic
function renderResults(noAutoSelect) {
	var pageSize = pageSizeSelect.options[pageSizeSelect.selectedIndex].innerText;
	var length   = (resultsFiltered ? resultsFiltered : results).Result.length;
	var offset   = (currentPage-1) * pageSize;
	var count    = Math.min(pageSize, length - offset);

	checkboxAll.checked = false;
	resultsBody.innerHTML = buildResultsHtml(offset, count);

	// Handle Previous / Next Page button visibility and state
	if (length < pageSize) {
		prevPageButton.classList.remove("display");
		nextPageButton.classList.remove("display");
	} else {
		prevPageButton.classList.add("display");
		nextPageButton.classList.add("display");

		prevPageButton.disabled = (offset < 1);
		nextPageButton.disabled = (offset + count >= length);
		
		prevPageButton.title = prevPageButton.disabled ? "Already at the first Page of the Results" : "Go to the previous Page with Results";
		nextPageButton.title = nextPageButton.disabled ? "Already at the last Page of the Results"  : "Go to the next Page with Results";
	}
	
	// Hookup click-event handlers for all results
	var rows = qsAll("#tbody tr");
	for (var i=0; i < rows.length; i++) rows[i].onclick = clickResultRow;

	var comments = qsAll("#tbody tr .comment");
	for (var i=0; i < comments.length; i++) comments[i].onclick = showComment;

	// Auto-select the first item unless Filter is active
	if (!noAutoSelect) {
	
		// Simulate click to load first result unless it's the first page load (2 messages).
		if (results.mesg != "firstClick") {
			rows[0].click();
		} else {
			// When the users manually switches Results pages, Auto-select the first result 'client-side' only
			rows[0].classList.add("selected");
			results.mesg = "";						// Wipe first-use flag in case the user uses clicks a prev/next Page button before any new VsCode API event
		}
	}
}

function buildResultsHtml(offset, count) {

// Row by row
var html = "";
for (var i=0; i < count; i++) {
    var result			= resultsFiltered ? resultsFiltered.Result[offset + i] : results.Result[offset + i];
    var nodeCount		= result.Path[0].PathNode.length -1;
    var state			= results.resultStates.states[result.$.state].name;
    var srcFile			= String(result.Path[0].PathNode[0].FileName);
    var srcFolder       = srcFile.slice(0, srcFile.lastIndexOf("/"));
    var srcFileName 	= srcFile.slice(srcFile.lastIndexOf("/") +1);
    var srcName			= String(result.Path[0].PathNode[0].Name);
    var destFile		= String(result.Path[0].PathNode[nodeCount].FileName);
    var destFolder      = destFile.slice(0, destFile.lastIndexOf("/"));
    var destFileName	= destFile.slice(destFile.lastIndexOf("/") +1);
    var destName		= String(result.Path[0].PathNode[nodeCount].Name);
    var comments 		= String(result.$.Remark).split(/\r?\n/); 	// Split on newline(s)
    var comment 		= "";
    var noComment		= false;

    // Encode comments HtmlAttribute proof
    for (var n=0; n < comments.length; n++) comment += htmlEscape(comments[n]).trim() + "\n"; 
    noComment = (comment.replaceAll("\n", "").length < 1);
    if (noComment) comment = "No comment yet... Click to add a comment.";

    html += "<tr id='result_" 					 + (offset + i) + "' class='result'>" +
            "<td class='vcenter'><input value='" + result.Path[0].$.PathId + "' type='checkbox' name='querySelected'></td>" +
            "<td class='numeric' title='"+ result.Path[0].$.PathId +"'>" 				 + result.Path[0].$.PathId + "</td>" +
            "<td class='state' title='" + state + "'>" + state + "</td>" +
            "<td title='" + result.$.Status +"'>" 								 + result.$.Status + "</td>" +
            "<td class='break' title='" + srcFolder +"'>" 				 + srcFolder + "</td>" +
            "<td title='" + srcFileName +"'>"		 						 + srcFileName + "</td>" +
            "<td class='numeric'  title='" + result.Path[0].PathNode[0].Line +"'>" 				 + result.Path[0].PathNode[0].Line + "</td>" +
            "<td title='" + srcName +"'>" 								 + srcName + "</td>" +
            "<td class='break' title='" + destFolder +"'>"				 + destFolder + "</td>" +
            "<td title='" + destFileName +"'>" 								 + destFileName + "</td>" +
            "<td class='numeric' title='" + result.Path[0].PathNode[nodeCount].Line +"'>"				 + result.Path[0].PathNode[nodeCount].Line + "</td>" +
            "<td title='" + destName +"'>" 								 + destName + "</td>" +
            "<td title='" + result.$.AssignToUser +"'>" 								 + result.$.AssignToUser + "</td>" + 
			"<td  title='" + comment + "'><center><img class='comment' src='data:image/png;base64,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'  width='15' height='15' /></center>"
             + "</td>" +
        "</tr>";
}
return html;
}
function filterResult(e) {
	var propName = e.target.name;
	var filter   = (propName == "state" || propName == "assignedUser") ? e.target.options[e.target.selectedIndex].value : e.target.value.toUpperCase(); 
	var matches  = [];

	currentPage = 1;

	if (filter == "") {
		resultsFiltered = null;	// Reset back to raw Results
	} else {

		for (var i=0; i < results.Result.length; i++) {
			var result			= results.Result[i];
			var nodeCount		= result.Path[0].PathNode.length -1;
			
			var state 			= result.$.state;
			var srcFile			= String(result.Path[0].PathNode[0].FileName).toUpperCase();
			var srcFolder       = srcFile.slice(0, srcFile.lastIndexOf("/"));
			var srcFileName 	= srcFile.slice(srcFile.lastIndexOf("/") +1);
			var srcLine			= parseInt(result.Path[0].PathNode[0].Line);
			var srcName			= String(result.Path[0].PathNode[0].Name).toUpperCase();
			var destFile		= String(result.Path[0].PathNode[nodeCount].FileName).toUpperCase();
			var destFolder      = destFile.slice(0, destFile.lastIndexOf("/"));
			var destFileName	= destFile.slice(destFile.lastIndexOf("/") +1);
			var destLine		= parseInt(result.Path[0].PathNode[nodeCount].Line);
			var destName		= String(result.Path[0].PathNode[nodeCount].Name).toUpperCase();

			// Handle property search. We use the '&&' as an inline if-statement to prevent the switch statement from becoming too lengthy.
			switch (propName) {
				case "state":			state.indexOf(filter) 			> -1 && matches.push(result); break;
				case "srcFolder":		srcFolder.indexOf(filter) 		> -1 && matches.push(result); break;
				case "srcFileName":		srcFileName.indexOf(filter) 	> -1 && matches.push(result); break;
				case "srcLine":			srcLine == parseInt(filter) 		 && matches.push(result); break;
				case "srcName":			srcName.indexOf(filter) 		> -1 && matches.push(result); break;
				case "destFolder":		destFolder.indexOf(filter) 		> -1 && matches.push(result); break;
				case "destFileName":	destFileName.indexOf(filter) 	> -1 && matches.push(result); break;
				case "destLine":		destLine == parseInt(filter)		 && matches.push(result); break;
				case "destName":		destName.indexOf(filter) 		> -1 && matches.push(result); break;
				default:
			}
		}

		resultsFiltered = { Result : matches };
	}
	renderResults(true);	// Render new results without auto-select of first Result
	e.stopPropagation();
}

// Return all checbox-selected PathIds for bulk operations.
function getSelectedPathIds() {
	var nodes  = qsAll("#tbody tr input[type='checkbox']:checked");
	var values = [];
	for (var i=0; i < nodes.length; i++) values.push(nodes[i].value);
	return (values.length < 1) ? [qs("#tbody tr.selected input[type='checkbox']").value] : values;
}


// Handle Select All Checkbox changes
function checkboxAllChange() {
	var checkboxes = qsAll("#tbody tr input[type='checkbox']");
	for (var i=0; i < checkboxes.length; i++) checkboxes[i].checked = checkboxAll.checked;
}


// Handle Result State change
function changeResultState() {
	if (resultStateSelect.selectedIndex == 0) return false; 								// Ignore top 'placeholder' entry, functions as a 'Cancel'

	var pathIds = getSelectedPathIds();
	if (pathIds.length >= 1) {

		var newValue = resultStateSelect.options[resultStateSelect.selectedIndex].value;

		// The saveComment function handles mandatoryComments with a "resultstateChangeEvent" too.
		if ((strictNE && newValue == 1) || strictAll) return showComment( { target: { tagName: "SELECT" } } );

		vscode.postMessage({command: "resultstateChangeEvent", resultStateTobeChange: newValue, data: pathIds });
		if (pathIds.length > SHOW_LOADING_THRESHOLD) statusMessage.classList.add("loading");

		// Only reset after 'post' to not have the user redo the existing selection on a retry
		checkboxAll.checked = false;

	} else {
		showStatusMessage (ERR_NO_SELECTION, STATUS_DISPLAY_TIMEOUT);
	}

	// Reset State (but not in case of Mandatory Comment, hence the return statement earlier).
	resultStateSelect.selectedIndex = 0; 													
}


// Handle Assign User change
function changeAssignUser() {
	if (assignUserSelect.selectedIndex == 0) return false; 					// Ignore top 'placeholder' entry, functions as a 'Cancel'

	var pathIds = getSelectedPathIds();
	if (pathIds.length >= 1) {
		var newValue = assignUserSelect.options[assignUserSelect.selectedIndex].value;
		if (pathIds.length > SHOW_LOADING_THRESHOLD) statusMessage.classList.add("loading");
		vscode.postMessage({command: "assignUser", assignUser: newValue, data: pathIds });
		checkboxAll.checked = false;							// Only reset on 'success' to not have the user redo the existing selection on a retry
	} else {
		showStatusMessage (ERR_NO_SELECTION, STATUS_DISPLAY_TIMEOUT);
	}
	assignUserSelect.selectedIndex = 0;
}

function clickPageButton(e) {
	currentPage += (e.target == prevPageButton) ? -1 : 1;
	renderResults();
}


// Handle Result Node Click
function clickResultRow(e) {
	var target   = (e.target.tagName == "TD") ? e.target.parentNode : e.target;
	var previous = qs("#tbody tr.selected");
	if (previous != target) {
		if (previous) previous.classList.remove("selected");
		target.classList.add("selected");
	}
	var i = target.id.split('_')[1] != undefined ? target.id.split('_')[1] : target.parentNode.parentNode.id.split('_')[1];
	vscode.postMessage({ path: results.Result[i].Path, command: "onClick", clickedRow: i });
}


// Show Comments Overlay with Existing Comment(s), the New Comment textarea and Save and Cancel buttons.
// pathId holds the Single Comment to update when saving. For 'Bulk Comments' usage, provide -1. See also the 'saveComments' function.
// html is the body of the existing comment. It should already be sanitised before calling this function. 
// Pressing the Escape key will cancel the comment.
function showComment(e) {
	
	var source = e.target;
	var html   = "";
	var pathId = -1;	

	// The actively selected Result Row (if any)
	var activeRow = qs("#tbody tr.selected");

	// Handle all use-cases
	switch (source.tagName) {

		// When the regular 'Add Comment Button is clicked
		case "BUTTON":
		case "SELECT":
		
			// Check number of selected results
			var pathIds = getSelectedPathIds();
			switch (pathIds.length) {

				// Basic Error Message
				case 0: 
					showStatusMessage (ERR_NO_SELECTION, STATUS_DISPLAY_TIMEOUT);
					return;
					
				// Either make the single selected checkbox Result 'selected', otherwise use the 'active Row'. 
				case 1:
					pathId = pathIds[0];
					var checkbox = qs("#tbody tr input[type='checkbox']:checked");
					html = (checkbox ? checkbox.parentNode.parentNode : activeRow).querySelector(".state").title;
					break;

				default:
					// Show remark for Mandatory Comments
					if (strictNE || strictAll) html = INFO_MANDATORY_COMMENTS;
			}
			

			break;

		// When the Result-specific 'State Results' column is clicked
		case "TD":
		
			// Fetch Result details
			pathId = source.parentNode.querySelector("input[type='checkbox']").value; 
			html = source.parentNode.querySelector(".state").title; 
			
			break;
		case "IMG":
		
			// Fetch Result details
			pathId = source.parentNode.parentNode.parentNode.querySelector("input[type='checkbox']").value;
			html = source.parentNode.parentNode.title;
			
			break;
			
		default:
			description.innerHTML = "# Unknown showComment source tagName: " + source.tagName + "#";
			return;
	}

	// Hide background Results TableTable to prevent content-overflow and thus scrollbars while Overlay is visible
	qs("#results").style.display = "none";

	commentPathId.value = pathId;
	commentError.innerHTML = "<span class='success'>" + (pathId != "-1" ? "Add comment for ID #" + pathId : INFO_BULK_COMMENTS) + "</span>";
	existingComments.innerHTML = html.replaceAll("\n", "<br>");
	commentOverlay.classList.add("flex");
	newComment.focus();
	event.stopPropagation();	// We want no side-steering
	return false;
}

// Handle Cancel Button click for the Comments Overlay, restoring Results Table
function cancelComment() {
	commentOverlay.classList.remove("flex");
	qs("#results").style.display = "table";
	resultStateSelect.selectedIndex = 0;	// Reset to default for cancelled 'Mandatory Comments' ***
}

// Handles Saving of all Comments and Result-State updates when 'Mandatory Comment' is True. 
// For Single Comments, the commentPathId should be properly set
// For Bulk Comments, the commentPathId should be -1; trigging the iteration of selected Result-checkboxes automatically.
// When 'Mandatory Comments' is true, it will auto-detect the Result State dropdown assignment vs regular Bulk Comments.
function saveComment() {
	var comment = newComment.value.trim();
	if (!comment) {
		commentError.innerHTML = ERR_EMPTY_COMMENT;
		newComment.focus();
		return false;
	}
	
	if (commentPathId.value != "-1") {
		vscode.postMessage({command: 'updateComment', inputCommentValue: comment, pathId: commentPathId.value });
	} else {
		var pathIds = getSelectedPathIds();
		if (strictNE || strictAll ) {
			if (resultStateSelect.selectedIndex != 0) { 
				vscode.postMessage({command: 'resultstateChangeEvent', bulkComment: comment, resultStateTobeChange: resultStateSelect.options[resultStateSelect.selectedIndex].value, data: pathIds });
			} else {                          
				vscode.postMessage({command: 'bulkComments', bulkComment: comment, data: pathIds });
			}
		} else {
			vscode.postMessage({command: 'bulkComments', bulkComment: comment, data: pathIds });
		}
		if (pathIds.length > SHOW_LOADING_THRESHOLD) statusMessage.classList.add("loading");
		checkboxAll.checked = false;
	
	}
	
	// Cleanup & hide Overlay
	newComment.value = "";
	cancelComment();
}


// Update Query Result description
function updateDescription() { description.innerHTML = (!results.description.shortDescription) ? INFO_NO_DESCRIPTION : INFO_DESCRIPTION_PREFIX + results.description.shortDescription }


// Show & Hide/Reset Action Error Message with optimal auto-hide timeout in ms.
function showStatusMessage(html, timeout) { 
	statusMessage.innerHTML = html; 
	if (timeout) { 
		if (timeoutRef) clearTimeout(timeoutRef); 
		timeoutRef = setTimeout(resetStatusMessage, timeout); 
	}
}


function resetStatusMessage() { 
	statusMessage.innerHTML = "";
	timeoutRef = null;
}


// Short hand Generic Helper routines
function qs(s) 				{ return document.querySelector(s)    }
function qsAll(s) 			{ return document.querySelectorAll(s) }

function magicSplit(text, length, splitter) { return text.replace(new RegExp(`.{${length}}`, 'g'), '$&' + splitter) }

// Html Attribute Encoding & Decoding, currently used for Comments only; please note '\/' sequences are replaced by '/' and not reversed during Unescaping.
function htmlEscape  (input) { return input.replace(/&/g, '&amp').replace(/'/g, '&apos').replace(/"/g, '&quot').replace(/>/g, '&gt').replace(/</g, '&lt').replace(/\//g, '/') }
function htmlUnescape(input) { return input.replace(/&amp/g, '&').replace(/&apos/g, "'").replace(/&quot/g, '"').replace(/&gt/g, '>').replace(/&lt/g, '<') }


window.onload = function start() { 

	// Hookup our VsCode Message Listener
	window.onmessage = handleMessage;

	// Hookup Bulk Comment button event handler
	qs("#addCommentButton").onclick = showComment;

	// Hookup the Page Button & PageSize Select event handlers
	prevPageButton.onclick = nextPageButton.onclick = clickPageButton;
	pageSizeSelect.onchange = changePageSizeAndRefresh;	 

	// Reset & hookup Select All Results checkbox 
	checkboxAll.onchange = checkboxAllChange;

	// Hookup the Column Filter event-handlers
	var filters = qsAll("tr.filters INPUT[type='text']");
	for (var i=0; i < filters.length; i++) filters[i].onkeyup = filterResult;

	// Route [ESC] press to Cancel button click
	commentOverlay.onkeyup = function handleEscape(e) { if (e.keyCode == 27) cancelComment() }

}
</script>
</html>